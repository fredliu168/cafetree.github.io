---
title: 通过树莓派4共享CMCC上网
date: 2020-04-17 17:06:52
tags: 树莓派
---

由于没有其他网络，只能通过 cmcc 上网，想通过共享的方式提供给其他设备上网。手头刚好有个闲置的树莓派 4，树莓派装了 ubuntu 的系统（测试树莓派自带系统同样可用）

步骤一：

a) 设置一下有线网口的 eth0 IP 192.168.1.2，做一下下 nat 转发

b) 把接有线网口的网线连接到小米路由的 wan 口

c) 然后把小米路由器的地址上网设置成静态 IP，网关设置树莓派的 IP

d) 通过其他设备测试是否可以成功连接互联网。

树莓派设置：

```sh
ifconfig eth0 192.168.1.2/24
sysctl net.ipv4.ip_forward=1
iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE
iptables -t nat -nL
```

小米路由器设置：

```
192.168.1.3
255.255.255.0
网关：192.168.1.2
DNS：8.8.8.8
```

步骤二：

如果通过上述步骤无法成功联网，可以先把树莓派网线接到电脑的网口上，同时修改一下电脑的静态 ip，要和树莓派的同一个网段，测试一下是否能连接到树莓派，如果无法联通，重启一下树莓派，使用树莓派的默认 ip 进行设置。

查看树莓派的 ip

```
ifconfig
```

然后把步骤一的 ip 改成当前树莓派的 ip 即可。
