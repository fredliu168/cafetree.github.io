<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 运维笔记</title><meta name="description" content="略懂一点编程."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.qzcool.xyz/atom.xml" title="运维笔记"><link rel="alternate" href="/atom.xml" title="运维笔记" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">运维笔记</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/fredliu168" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="body-container"><div id="post-list" class="left"><div class="home post-list"><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/04/24/树莓派Docker设置代理/" class="post-title-link">树莓派Docker设置代理</a></h2><div class="post-info">Apr 24, 2020</div><div class="post-content"><p>Docker 无法访问到仓库，网上找的方法都无效，发现 Docker 是通过 snap 安装的，通过下面的方法实现了代理访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/snap.docker.dockerd.service</span><br></pre></td></tr></table></figure>
<p>添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">...</span><br><span class="line">Environment=&quot;HTTPS_PROXY=socks5://127.0.0.1:1080&quot;</span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo snap restart docker</span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure>
<p>可以正常访问到仓库了。</p>
<p>其他（上面的设置突然无效了,使用下面有效）</p>
<p>写入代理设置</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /lib/systemd/system/docker.service.d</span><br><span class="line">cat &gt; /lib/systemd/system/docker.service.d/socks5-proxy.conf &lt;&lt;EOF</span><br><span class="line">[Service]</span><br><span class="line">Environment="ALL_PROXY=socks5://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">1080</span>"</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>重新加载配置</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></div><a href="/2020/04/24/树莓派Docker设置代理/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/04/23/Mac设置Anaconda环境变量/" class="post-title-link">Mac设置Anaconda环境变量</a></h2><div class="post-info">Apr 23, 2020</div><div class="post-content"></div><a href="/2020/04/23/Mac设置Anaconda环境变量/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/04/17/通过树莓派4共享CMCC上网/" class="post-title-link">通过树莓派4共享CMCC上网</a></h2><div class="post-info">Apr 17, 2020</div><div class="post-content"><p>由于没有其他网络，只能通过 cmcc 上网，想通过共享的方式提供给其他设备上网。手头刚好有个闲置的树莓派 4，树莓派装了 ubuntu 的系统（测试树莓派自带系统同样可用）</p>
<p>步骤一：</p>
<p>a) 设置一下有线网口的 eth0 IP 192.168.1.2，做一下下 nat 转发</p>
<p>b) 把接有线网口的网线连接到小米路由的 wan 口</p>
<p>c) 然后把小米路由器的地址上网设置成静态 IP，网关设置树莓派的 IP</p>
<p>d) 通过其他设备测试是否可以成功连接互联网。</p>
<p>树莓派设置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 192.168.1.2/24</span><br><span class="line">sysctl net.ipv4.ip_forward=1</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE</span><br><span class="line">iptables -t nat -nL</span><br></pre></td></tr></table></figure>
<p>小米路由器设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.3</span><br><span class="line">255.255.255.0</span><br><span class="line">网关：192.168.1.2</span><br><span class="line">DNS：8.8.8.8</span><br></pre></td></tr></table></figure></div><a href="/2020/04/17/通过树莓派4共享CMCC上网/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/04/10/Docker常用操作命令/" class="post-title-link">Docker常用操作命令</a></h2><div class="post-info">Apr 10, 2020</div><div class="post-content"></div><a href="/2020/04/10/Docker常用操作命令/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/03/16/Nginx泛域名添加https免费SSL证书Lets-Encrypt-certbot-安装使用步骤/" class="post-title-link">Nginx泛域名添加https免费SSL证书Lets Encrypt(certbot)安装使用步骤
</a></h2><div class="post-info">Mar 16, 2020</div><div class="post-content"><p>本文介绍如何在 nginx 服务器上使用免费的 Let’s Encrypt 凭证，提供 HTTPS 的安全加密网页。</p>
<p>使用Certbot进行进行证书更新,可以参考以下文章<br><a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx" target="_blank" rel="noopener">https://certbot.eff.org/lets-encrypt/centosrhel7-nginx</a></p>
<p><a href="https://www.shookm.com/2021/03/05/Certbot%E9%85%8D%E7%BD%AELet&#39;s%20Encrypt%E7%9A%84https_ssl%E8%AF%81%E4%B9%A6%E4%BB%A5%E5%8F%8A%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98(2021%E6%9B%B4%E6%96%B0)/" target="_blank" rel="noopener">https://www.shookm.com/2021/03/05/Certbot%E9%85%8D%E7%BD%AELet&#39;s%20Encrypt%E7%9A%84https_ssl%E8%AF%81%E4%B9%A6%E4%BB%A5%E5%8F%8A%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98(2021%E6%9B%B4%E6%96%B0)/</a></p>
<h1 id="Centos-下安装"><a href="#Centos-下安装" class="headerlink" title="Centos 下安装"></a>Centos 下安装</h1><p>先进行安装依赖等配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@j certbot]# yum install epel-release                 # 安装epel</span><br><span class="line">[root@j certbot]# yum install snapd                        # 安装snapd</span><br><span class="line">[root@j certbot]# systemctl enable --now snapd.socket      # 启用snapd.socket</span><br><span class="line">[root@j certbot]# ln -s /var/lib/snapd/snap /snap          # 创建软链接</span><br><span class="line">[root@j certbot]# snap install --classic certbot           # 安装certbot</span><br><span class="line">[root@j certbot]# ln -s /snap/bin/certbot /usr/bin/certbot # 创建certbot软链接</span><br></pre></td></tr></table></figure>
<p>如果之前安装过Certbot出现了问题，可以进行重装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@j certbot]# yum remove certbot                      # 卸载certbot</span><br><span class="line">[root@j certbot]# rm /usr/local/bin/certbot-auto          # 删除安装文件</span><br><span class="line">[root@j certbot]# rm -rf /opt/eff.org/certbot</span><br></pre></td></tr></table></figure>
<p>certbot自动定时续期证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">certbot renew #手动测试，查看证书过期时间</span><br><span class="line"></span><br><span class="line">certbot renew --force-renewal #忽略证书过期时间，直接重置证书时间</span><br><span class="line"></span><br><span class="line">crontab -e #定时任务</span><br><span class="line"></span><br><span class="line">0 0 1 * * /usr/bin/certbot renew --force-renewal #编辑文件</span><br></pre></td></tr></table></figure></div><a href="/2020/03/16/Nginx泛域名添加https免费SSL证书Lets-Encrypt-certbot-安装使用步骤/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2020/01/14/iMac如何通过快捷键连接AirPods耳机/" class="post-title-link">iMac如何通过快捷键连接AirPods耳机</a></h2><div class="post-info">Jan 14, 2020</div><div class="post-content"></div><a href="/2020/01/14/iMac如何通过快捷键连接AirPods耳机/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2019/12/24/AirPods2使用体验/" class="post-title-link">AirPods2使用体验</a></h2><div class="post-info">Dec 24, 2019</div><div class="post-content"><p>为情怀买单,双11某东做活动,AirPods2降了300快,就入手了一个,当时AirPods出来的时候就很想买一个,但是价格有点贵而且是刚出来的产品想想等第二代有机会再入手一个,等到今年AirPods终于出二代了,出二代的时候网上流传要出一个Pro版本,等到10月份果然出了一个Pro版的,但是是入耳式的,怕佩戴不舒服就放弃而且价格是AirPods的两倍就决定买AirPods了.<br><img src="/2019/12/24/AirPods2使用体验/Airpods.jpg" title="This is an image"></p></div><a href="/2019/12/24/AirPods2使用体验/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2019/12/24/PyCharm激活方法/" class="post-title-link">PyCharm激活方法</a></h2><div class="post-info">Dec 24, 2019</div><div class="post-content"></div><a href="/2019/12/24/PyCharm激活方法/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2019/11/15/ubuntu-配置双网卡路由/" class="post-title-link">Ubuntu,MacOS和Windows10 配置双网卡路由</a></h2><div class="post-info">Nov 15, 2019</div><div class="post-content"></div><a href="/2019/11/15/ubuntu-配置双网卡路由/" class="read-more">READ MORE</a></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2019/11/15/ubuntu-18-04-dlink-dwa171-revC-安装驱动/" class="post-title-link">ubuntu 18.04 - dlink dwa171 (revC)安装驱动</a></h2><div class="post-info">Nov 15, 2019</div><div class="post-content"></div><a href="/2019/11/15/ubuntu-18-04-dlink-dwa171-revC-安装驱动/" class="read-more">READ MORE</a></article></div></div></div><div id="sidebar" class="left"><div id="about-panel"><div class="info"><div class="title">marsland</div><div class="url">https://blog.qzcool.xyz</div><div class="bio">follow your heart</div></div><img src="/images/avatar.png" class="avatar"></div><div id="friend-links-panel"><div class="panel-title"><p>LINKS</p></div><a href="http://powman.org" target="_blank" class="link-item"><div class="link-container"><div class="site-name">AngryPowman</div><div class="site-desc">This is a link</div></div></a></div></div></div><div class="clear"></div></main><footer class="footer-container"><div class="paginator"><a href="/page/2/" class="prev">PREV</a><a href="/page/4/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2021 <a href="https://blog.qzcool.xyz">marsland</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"fishman",'auto');ga('send','pageview');</script></body></html>