<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ubuntu 18.04 - dlink dwa171 (revC)安装驱动 · 非鱼记</title><meta name="description" content="ubuntu 18.04 - dlink dwa171 (revC)安装驱动 - fredliu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.qzcool.com/atom.xml" title="非鱼记"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">非鱼记</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/fredliu168" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">ubuntu 18.04 - dlink dwa171 (revC)安装驱动</h1><div class="post-info">Nov 15, 2019</div><div class="post-content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo apt update</div><div class="line">sudo apt install build-essential git dkms</div><div class="line">git clone https://github.com/brektrou/rtl8821CU.git</div><div class="line">cd rtl8821CU</div><div class="line">chmod +x dkms-install.sh</div><div class="line">sudo ./dkms-install.sh</div><div class="line"></div><div class="line">sudo modprobe 8821cu</div></pre></td></tr></table></figure>
<p>Problem of not being able to use D-Link AC600 (DWA 171 Revision C) as WiFi USB as it is recognised as USB Flush Memory (storing Windows driver files). Note that this is NOT about DWA 171 revision A.</p>
<h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>As per Problem with Wi-Fi USB Adapter D-Link DWA-171:</p>
<p>A DWA-171 Revision C became available in 2018, and is marked as such on the dongle label. The revA is a straightforward wifi dongle – with the correct Linux driver installed, plug in the dongle and you’re off to the races. But the revC first enumerates as USB Storage, and as such contains a Setup.exe to install Windows drivers.</p>
<p>lsusb shows the DWA 171 Revision C as Realtek flash drive.</p>
<p>Bus 003 Device 005: ID 0bda:1a2b Realtek Semiconductor Corp.    &lt;—– USB Flash memory mode of DWA 171</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>As per Automatically use usb_modeswitch for Wifi USB, run usb_modeswitch as below (after , and confirm with lsusb and ip commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ lsusb</div><div class="line">...</div><div class="line">Bus 003 Device 005: ID 0bda:1a2b Realtek Semiconductor Corp.</div><div class="line"></div><div class="line">$ /usr/sbin/usb_modeswitch -K -v 0bda -p 1a2b</div><div class="line">$ lsusb</div><div class="line">...</div><div class="line">Bus 003 Device 006: ID 2001:331d D-Link Corp.  &lt;--- Changed from Realtek</div><div class="line"></div><div class="line">$ ip link show</div><div class="line">...</div></pre></td></tr></table></figure>
<p>3: wlx58d56e015102: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state </p>
<p>UP mode DORMANT group default qlen 1000<br>    link/ether 58:d5:6e:01:51:02 brd ff:ff:ff:ff:ff:ff<br>Explanation<br>The REFERENCE document included in the usb-modeswitch-data package says -K means ejecting the device.</p>
<p>StandardEject &lt;0/1&gt; -K<br>Sends a specific bulk message sequence representing the SCSI commands “ALLOW MEDIUM REMOVAL” and “START STOP UNIT”, basically an eject action. Many modems are using this for mode switching. Can be combined with one additional ‘MessageContent’</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>To use the D-Link AC 600 (DWA 171 Revision C) as USB WiFi.</p>
<p>Compile, install, and load the 8821cu module (NOT 8821au).<br>Verify the module is loaded with lsmod.<br>Eject the USB flash drive with usb_modeswitch -K.<br>Verify the USB WiFi D-Link is displayed with lsusb.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://www.draisberghof.de/usb_modeswitch/" target="_blank" rel="external">USB_ModeSwitch - Handling Mode-Switching USB Devices on Linux</a></p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'fishman-1';
var disqus_identifier = '2019/11/15/ubuntu-18-04-dlink-dwa171-revC-安装驱动/';
var disqus_title = 'ubuntu 18.04 - dlink dwa171 (revC)安装驱动';
var disqus_url = 'https://blog.qzcool.com/2019/11/15/ubuntu-18-04-dlink-dwa171-revC-安装驱动/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//fishman-1.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2019/11/15/ubuntu-配置双网卡路由/" class="prev">PREV</a><a href="/2019/11/12/charles系列破解激活办法(最高charles4-2都可以激活)/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2020 <a href="https://blog.qzcool.com">fredliu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"fishman",'auto');ga('send','pageview');</script></body></html>