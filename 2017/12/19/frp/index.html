<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iMac如何使用frp实现内网穿透 · 瞎折腾</title><meta name="description" content="iMac如何使用frp实现内网穿透 - fredliu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.qzcool.com/atom.xml" title="瞎折腾"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">瞎折腾</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github/fredliu168" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">iMac如何使用frp实现内网穿透</h1><div class="post-info">Dec 19, 2017</div><div class="post-content"><p>有时需要把内网部署的站点映射到外网，让其别人也能访问到，例如做微信相关开发时需要把内网映射到外网，让微信服务器能访问到你的开发环境，方便开发调试。可以使用花生壳或者ngrok，前面这两种我都使用过，花生壳用起来很不稳定，花了钱还不能解决问题，ngrok现在已经很久没更新了，国内的可以在<a href="https://www.ngrok.cc" target="_blank" rel="external">https://www.ngrok.cc</a> 注册，免费用户仅能使用一个转发，由于是使用香港的服务器经常连接不上，最后狠下心来研究了下内网穿透，发现frp使用起来还可以，本文就介绍在iMac下如何用阿里云用frp做内网穿透，Windows的应该流程也类似。</p>
<blockquote>
<p>frp开源地址:<a href="https://github.com/fatedier/frp" target="_blank" rel="external">https://github.com/fatedier/frp</a></p>
</blockquote>
<h3 id="一-服务器配置"><a href="#一-服务器配置" class="headerlink" title="一.服务器配置"></a>一.服务器配置</h3><h5 id="1-使用终端ssh远程连接阿里云服务器"><a href="#1-使用终端ssh远程连接阿里云服务器" class="headerlink" title="1.使用终端ssh远程连接阿里云服务器"></a>1.使用终端ssh远程连接阿里云服务器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -t root@xxx.xxx.xxx.xxx -p 22</div></pre></td></tr></table></figure>
<p>进入到/home目录，创建文件夹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir frp</div></pre></td></tr></table></figure></p>
<h5 id="2-下载对应的frp发布版本"><a href="#2-下载对应的frp发布版本" class="headerlink" title="2.下载对应的frp发布版本"></a>2.下载对应的frp发布版本</h5><p>先查看服务器型号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/version</div></pre></td></tr></table></figure>
<p>本人服务器信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Linux version 4.4.0-101-generic (buildd@lcy01-amd64-006)</div></pre></td></tr></table></figure>
<p>下载frp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo wget  https://github.com/fatedier/frp/releases/download/v0.13.0/frp_0.13.0_linux_amd64.tar.gz</div></pre></td></tr></table></figure>
<p>我的阿里云服务器下载不了frp文件，就先下载文件到本地，然后用ssh远程上传到阿里云服务器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp -r frp_0.13.0_linux_amd64.tar.gz root@xxx.xxx.xxx.xxx:/home/frp/</div></pre></td></tr></table></figure></p>
<h5 id="3-配置frp服务端"><a href="#3-配置frp服务端" class="headerlink" title="3.配置frp服务端"></a>3.配置frp服务端</h5><p>解压到当前目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo tar xvf frp_0.13.0_linux_amd64.tar.gz</div></pre></td></tr></table></figure></p>
<p>解压之后进入目录会看到以下文件</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ls</div><div class="line">LICENSE  frpc  frpc.ini  frpc_full.ini  frps  frps.ini  frps_full.ini</div></pre></td></tr></table></figure>
<p>打开frps.ini文件，配置成如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">bind_addr = xxx.xxx.xxx.xxx</div><div class="line">bind_port = 7000</div><div class="line">vhost_http_port = 80</div><div class="line">vhost_https_port = 443</div><div class="line">dashboard_port = 7500</div><div class="line">dashboard_user = 你的仪表盘用户名</div><div class="line">dashboard_pwd = 你的仪表盘密码</div><div class="line">privilege_token = frp</div></pre></td></tr></table></figure></p>
<p>其中bind_port是自己设定的frp服务端端口<br>vhost_http_port是自己设定的http访问端口<br>vhost_https_port是自己设定的https访问端口<br>[ssh]部分是ssh反向代理<br>listen_port是自己设定的ssh访问端口<br>custom_domains是自定义域名，如果有自己的域名就写到这里<br>privilege_token是验证凭据，服务端和客户端的凭据必须一样才能连接，当然为了安全还是设置长一点。dashborad的三个配置是仪表盘功能的端口以及用户名和密码，为了安全也要设置的长一点。</p>
<p>保存上面的配置后，使用以下指令启动frp服务端。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./frps -c ./frps.ini</div></pre></td></tr></table></figure></p>
<p>查看frps.log然后应该会显示类似下面的文本，说明服务端启动成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Start frps success</div><div class="line">PrivilegeMode is enabled, you should pay more attention to security issues</div></pre></td></tr></table></figure></p>
<h3 id="二-客户端配置"><a href="#二-客户端配置" class="headerlink" title="二.客户端配置"></a>二.客户端配置</h3><p>iMac下载对应的frp版本frp_0.13.0_darwin_amd64.tar.gz<br>解压后有对应的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ls</div><div class="line">LICENSE  frpc  frpc.ini  frpc_full.ini  frps  frps.ini  frps_full.ini</div></pre></td></tr></table></figure></p>
<p>frpc和frpc.ini、frpc_full.ini 是客户端对应的配置文件<br>我的frpc.ini配置对应如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[common]</div><div class="line">server_addr = xxx.xxx.xxx.xxx</div><div class="line">server_port = 7000  </div><div class="line"># console or real logFile path like ./frpc.log</div><div class="line">log_file = ./frpc.log </div><div class="line"># trace, debug, info, warn, error</div><div class="line">log_level = trace </div><div class="line">log_max_days = 3 </div><div class="line"># for authentication</div><div class="line">privilege_token = #######</div><div class="line"> </div><div class="line"># connections will be established in advance, default value is zero</div><div class="line">pool_count = 5 </div><div class="line"># if tcp stream multiplexing is used, default is true, it must be same with frps</div><div class="line">tcp_mux = true </div><div class="line"># your proxy name will be changed to &#123;user&#125;.&#123;proxy&#125;</div><div class="line">user = qzcool </div><div class="line"># decide if exit program when first login failed, otherwise continuous relogin to frps</div><div class="line"># default is true</div><div class="line">login_fail_exit = true </div><div class="line">[weixin]</div><div class="line">type = http</div><div class="line">local_ip = 127.0.0.1</div><div class="line">local_port = 8080</div><div class="line">use_encryption = false</div><div class="line">use_compression = false </div><div class="line">subdomain = weixin</div></pre></td></tr></table></figure></p>
<p>server_addr：对应的时阿里云的公网地址<br>server_port：服务端端口<br>privilege_token：token需要和服务端一致<br>最底下是配置站点信息<br>subdomain：子域名，假设服务器配置泛解析，子域名配置weixin，那么可以通过weixin.youdomin.com访问到你内网的8080端口</p>
<p>启动服务 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">macdeiMac:frp_0.13.0_darwin_amd64 fred$ sudo ./frpc -c ./frpc.ini</div></pre></td></tr></table></figure></p>
<p>然后使用浏览器访问weixin.youdomin.com就能访问到你的站点了。</p>
<h3 id="三-frp开机启动和后台运行"><a href="#三-frp开机启动和后台运行" class="headerlink" title="三.frp开机启动和后台运行"></a>三.frp开机启动和后台运行</h3><p>使用systemd配置开机自启，适用于 centos7 Ubuntu 16 或 debian 8。<br>vi /etc/systemd/system/frps.service 新建此文件，并写入以下内容:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line"></div><div class="line">Description=frps daemon</div><div class="line"></div><div class="line">After=syslog.target network.target</div><div class="line"></div><div class="line">Wants=network.target</div><div class="line"></div><div class="line">[Service]</div><div class="line"></div><div class="line">Type=simple</div><div class="line"></div><div class="line">ExecStart=/root/frp_0.13.0_linux_amd64/frps -c /root/frp_0.13.0_linux_amd64/frps_my.ini</div><div class="line"></div><div class="line">Restart= always</div><div class="line"></div><div class="line">RestartSec=1min</div><div class="line"></div><div class="line">[Install]</div><div class="line"></div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>启动并设为开机自启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl start frps //启动 </div><div class="line">systemctl status frps //状态查询 </div><div class="line">systemctl enable frps //开机启动</div></pre></td></tr></table></figure></p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'fishman';
var disqus_identifier = '2017/12/19/frp/';
var disqus_title = 'iMac如何使用frp实现内网穿透';
var disqus_url = 'https://blog.qzcool.com/2017/12/19/frp/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//fishman.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2019/10/30/换了Prontera风格/" class="prev">上一篇</a><a href="/2017/08/17/csharp-connect-timeout/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2019 <a href="https://blog.qzcool.com">fredliu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"fishman",'auto');ga('send','pageview');</script></body></html>