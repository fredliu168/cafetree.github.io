<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> nginx设置https · 运维笔记</title><meta name="description" content="nginx设置https - marsland"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.qzcool.xyz/atom.xml" title="运维笔记"><link rel="alternate" href="/atom.xml" title="运维笔记" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">运维笔记</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/fredliu168" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">nginx设置https</h1><div class="post-info">Aug 3, 2021</div><div class="post-content"><h2 id="SSH-into-the-server"><a href="#SSH-into-the-server" class="headerlink" title="SSH into the server"></a>SSH into the server</h2><p>SSH into the server running your HTTP website as a user with sudo privileges.</p>
<h2 id="Install-snapd"><a href="#Install-snapd" class="headerlink" title="Install snapd"></a>Install snapd</h2><p>You’ll need to install snapd and make sure you follow any instructions to enable classic snap support.<br>Follow these instructions on snapcraft’s site to install snapd.</p>
<p>Ensure that your version of snapd is up to date<br>Execute the following instructions on the command line on the machine to ensure that you have the latest version of snapd.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install core; sudo snap refresh core</span><br></pre></td></tr></table></figure>
<p>Remove certbot-auto and any Certbot OS packages<br>If you have any Certbot packages installed using an OS package manager like apt, dnf, or yum, you should remove them before installing the Certbot snap to ensure that when you run the command certbot the snap is used rather than the installation from your OS package manager. The exact command to do this depends on your OS, but common examples are sudo apt-get remove certbot, sudo dnf remove certbot, or sudo yum remove certbot.</p>
<p>If you previously used Certbot through the certbot-auto script, you should also remove its installation by following the instructions here.</p>
<h2 id="Install-Certbot"><a href="#Install-Certbot" class="headerlink" title="Install Certbot"></a>Install Certbot</h2><p>Run this command on the command line on the machine to install Certbot.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install --classic certbot</span><br></pre></td></tr></table></figure></p>
<p>Prepare the Certbot command<br>Execute the following instruction on the command line on the machine to ensure that the certbot command can be run.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /snap/bin/certbot /usr/bin/certbot</span><br></pre></td></tr></table></figure></p>
<p>Choose how you’d like to run Certbot<br>Either get and install your certificates…<br>Run this command to get a certificate and have Certbot edit your Nginx configuration automatically to serve it, turning on HTTPS access in a single step.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure></p>
<p>Or, just get a certificate<br>If you’re feeling more conservative and would like to make the changes to your Nginx configuration by hand, run this command.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot certonly --nginx</span><br></pre></td></tr></table></figure></p>
<h2 id="Test-automatic-renewal"><a href="#Test-automatic-renewal" class="headerlink" title="Test automatic renewal"></a>Test automatic renewal</h2><p>The Certbot packages on your system come with a cron job or systemd timer that will renew your certificates automatically before they expire. You will not need to run Certbot again, unless you change your configuration.</p>
<p>You can test automatic renewal for your certificates by running this command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure></p>
<p>If that command completes without errors, your certificates will renew automatically in the background.</p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'fishman-1';
var disqus_identifier = '2021/08/03/nginx设置https/';
var disqus_title = 'nginx设置https';
var disqus_url = 'https://blog.qzcool.xyz/2021/08/03/nginx设置https/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//fishman-1.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2021/08/26/Quantumult屏蔽掌上公交广告配置/" class="prev">PREV</a><a href="/2021/07/29/为iterm2设置代理/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2021 <a href="https://blog.qzcool.xyz">marsland</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"fishman",'auto');ga('send','pageview');</script></body></html>